var W=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var E=(s,a,t)=>a in s?W(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,C=(s,a)=>{for(var t in a||(a={}))Y.call(a,t)&&E(s,t,a[t]);if(D)for(var t of D(a))Z.call(a,t)&&E(s,t,a[t]);return s},V=(s,a)=>J(s,X(a));var b=(s,a,t)=>new Promise((r,o)=>{var l=c=>{try{i(t.next(c))}catch(u){o(u)}},n=c=>{try{i(t.throw(c))}catch(u){o(u)}},i=c=>c.done?r(c.value):Promise.resolve(c.value).then(l,n);i((t=t.apply(s,a)).next())});import{r as S,o as d,c as _,a as h,w as x,n as g,F as w,b as y,d as e,e as ee,f as te,u as k,g as m,h as A,i as O,v as se,j as B,p as F,k as N,t as p,l as M,m as oe,q as ae,s as ne,x as q,y as $,z as j,A as le,B as re,C as ie,D as ce}from"./vendor.433de25e.js";const ue=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}};ue();var T=(s,a)=>{const t=s.__vccOpts||s;for(const[r,o]of a)t[r]=o;return t};const de={},pe=y("Dashboard "),_e=y("Recent "),he=y("Queued "),me=y("Failed ");function fe(s,a){var r,o,l,n,i,c,u,f,v;const t=S("router-link");return d(),_(w,null,[h(t,{to:{name:"home"},class:"block p-4 rounded mb-2 cursor-pointer"},{default:x(()=>[pe]),_:1}),h(t,{to:{name:"recent"},class:g(["block p-4 rounded mb-2 cursor-pointer",{"router-link-active":((l=(o=(r=s.$route)==null?void 0:r.matched[0])==null?void 0:o.meta)==null?void 0:l.route)==="recent"}])},{default:x(()=>[_e]),_:1},8,["class"]),h(t,{to:{name:"queued"},class:g(["block p-4 rounded mb-2 cursor-pointer",{"router-link-active":((c=(i=(n=s.$route)==null?void 0:n.matched[0])==null?void 0:i.meta)==null?void 0:c.route)==="queued"}])},{default:x(()=>[he]),_:1},8,["class"]),h(t,{to:{name:"failed"},class:g(["block p-4 rounded mb-2",{"router-link-active":((v=(f=(u=s.$route)==null?void 0:u.matched[0])==null?void 0:f.meta)==null?void 0:v.route)==="failed"}])},{default:x(()=>[me]),_:1},8,["class"])],64)}var xe=T(de,[["render",fe]]);const ve={class:"flex"},ge={class:"basis-auto w-[250px] shrink-0 bg-white p-6 min-h-screen"},ye={class:"flex-1 max-w-[calc(100%-250px)] p-6"},be={setup(s){return(a,t)=>{const r=S("router-view");return d(),_("div",ve,[e("aside",ge,[h(xe)]),e("div",ye,[h(r)])])}}};function I(){return b(this,arguments,function*({endpoint:s,router:a,body:t=null,method:r="GET",login:o=!1}={}){const l=yield fetch(`/cloud-tasks-api/${s}`,V(C({method:r},t?{body:t}:{}),{headers:C({},o?{}:{Authorization:`Bearer ${localStorage.getItem("cloud-tasks-token")}`})}));return l.status===403&&!o&&(localStorage.removeItem("cloud-tasks-token"),a.push({name:"login"})),o?yield l.text():yield l.json()})}function L(r){return b(this,arguments,function*(s,a={},t){let o=!1;const l=function(c){return b(this,null,function*(){if(o)return;const u=new URL(window.location.href),f=new URLSearchParams(u.search);for(const[v,G]of Object.entries(a))f.append(v,G);o=!0,c.value=yield I({endpoint:`tasks?${f.toString()}`,router:t}),o=!1})};l(s);let n=setInterval(()=>l(s),3e3);ee(function(){setTimeout(()=>l(s))});const i=function(){document.visibilityState==="visible"?(l(s),clearInterval(n),n=setInterval(()=>l(s),3e3)):document.visibilityState==="hidden"&&clearInterval(n)};document.addEventListener("visibilitychange",i),te(()=>{clearInterval(n),document.removeEventListener("visibilitychange",i),o=!1})})}const z=s=>(F("data-v-59cd799c"),s=s(),N(),s),we={class:"block w-full h-full flex items-center justify-center"},ke=z(()=>e("h3",{class:"text-4xl"},"This application is password protected.",-1)),$e=["onKeyup","disabled"],Ce=z(()=>e("div",{class:"text-center mt-6 text-xl"},[y(" Press "),e("span",{class:"bg-blue-200 py-1 px-2 ml-2 mr-2 rounded text-blue-800"},"Enter"),y(" to log in. ")],-1)),qe={setup(s){const a=k(),t=m(null),r=m(""),o=m(""),l=m(!1),n=m(!1);A(()=>{t.value.focus()});function i(){return b(this,null,function*(){if(r.value===""||r.value===o.value)return;o.value=r.value;const c=new FormData;c.append("password",r.value),n.value=!0;const u=yield I({endpoint:"login",method:"POST",body:c,login:!0});n.value=!1,u?(localStorage.setItem("cloud-tasks-token",u),a.push({name:"home"})):(l.value=!0,setTimeout(()=>{l.value=!1},820),setTimeout(()=>t.value.focus(),50))})}return(c,u)=>(d(),_("div",we,[e("div",null,[ke,O(e("input",{type:"password",class:g(["w-full p-2 px-6 text-2xl font-light mt-8 text-center outline-none shadow rounded-full",{shake:l.value}]),onKeyup:B(i,["enter"]),"onUpdate:modelValue":u[0]||(u[0]=f=>r.value=f),disabled:n.value,ref_key:"inputRef",ref:t},null,42,$e),[[se,r.value]]),Ce])]))}};var Te=T(qe,[["__scopeId","data-v-59cd799c"]]);const Se=e("h3",{class:"text-3xl mb-4"},"All tasks",-1),Ae={class:"grid grid-cols-3 gap-4"},Ie=["textContent"],Le=e("span",{class:"text-gray-600"},"this minute",-1),Re=["textContent"],Pe=e("span",{class:"text-gray-600"},"this hour",-1),Ue=["textContent"],De=e("span",{class:"text-gray-600"},"today",-1),Ee=e("h3",{class:"text-3xl mb-4 mt-8"},"Failed tasks",-1),Ve={class:"grid grid-cols-3 gap-4"},Oe=["textContent"],Be=e("span",{class:"text-gray-600"},"this minute",-1),Fe=["textContent"],Ne=e("span",{class:"text-gray-600"},"this hour",-1),Me=["textContent"],je=e("span",{class:"text-gray-600"},"today",-1),ze={setup(s){const a=k(),t=m({recent:{this_minute:"...",this_hour:"...",today:"..."},failed:{this_minute:"...",this_hour:"...",today:"..."}});return A(()=>b(this,null,function*(){t.value=yield I({endpoint:"dashboard",router:a})})),(r,o)=>{const l=S("router-link");return d(),_(w,null,[Se,e("div",Ae,[h(l,{to:{name:"recent",query:{time:`${new Date().getUTCHours()}:${new Date().getUTCMinutes()}`}},class:"bg-white rounded-lg p-6"},{default:x(()=>{var n,i;return[e("span",{class:"block text-4xl",textContent:p((i=(n=t.value)==null?void 0:n.recent)==null?void 0:i.this_minute)},null,8,Ie),Le]}),_:1},8,["to"]),h(l,{to:{name:"recent",query:{hour:new Date().getUTCHours()}},class:"bg-white rounded-lg p-6"},{default:x(()=>{var n,i;return[e("span",{class:"block text-4xl",textContent:p((i=(n=t.value)==null?void 0:n.recent)==null?void 0:i.this_hour)},null,8,Re),Pe]}),_:1},8,["to"]),h(l,{to:{name:"recent"},class:"bg-white rounded-lg p-6"},{default:x(()=>{var n,i;return[e("span",{class:"block text-4xl",textContent:p((i=(n=t.value)==null?void 0:n.recent)==null?void 0:i.this_day)},null,8,Ue),De]}),_:1})]),Ee,e("div",Ve,[h(l,{to:{name:"failed",query:{time:`${new Date().getUTCHours()}:${new Date().getUTCMinutes()}`}},class:"bg-white rounded-lg p-6"},{default:x(()=>{var n,i;return[e("span",{class:"block text-4xl",textContent:p((i=(n=t.value)==null?void 0:n.failed)==null?void 0:i.this_minute)},null,8,Oe),Be]}),_:1},8,["to"]),h(l,{to:{name:"failed",query:{hour:new Date().getUTCHours()}},class:"bg-white rounded-lg p-6"},{default:x(()=>{var n,i;return[e("span",{class:"block text-4xl",textContent:p((i=(n=t.value)==null?void 0:n.failed)==null?void 0:i.this_hour)},null,8,Fe),Ne]}),_:1},8,["to"]),h(l,{to:{name:"failed"},class:"bg-white rounded-lg p-6"},{default:x(()=>{var n,i;return[e("span",{class:"block text-4xl",textContent:p((i=(n=t.value)==null?void 0:n.failed)==null?void 0:i.this_day)},null,8,Me),je]}),_:1})])],64)}}};const H={props:{status:String,classes:{type:Array,default:[]}},setup(s){function a(t){return t.charAt(0).toUpperCase()+t.slice(1)}return(t,r)=>(d(),_("span",{class:g(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",[`task-${s.status}`,...s.classes]])},p(a(s.status)),3))}},He={},Ke=e("tr",null,[e("td",{colspan:"7",class:"px-6 py-4 bg-white"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"indigo","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"indigo",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])])],-1),Qe=[Ke];function Ge(s,a){return d(),_("tbody",null,Qe)}var We=T(He,[["render",Ge]]);const Je=e("label",{for:"queue",class:"block mb-2 font-medium"},"Queue",-1),Xe=["onKeyup"],Ye=e("label",{for:"status",class:"block mb-2 mt-6 font-medium"},"Status",-1),Ze=ae('<option value="">List default</option><option value="queued">Queued</option><option value="running">Running</option><option value="successful">Successful</option><option value="error">Error</option><option value="failed">Failed</option>',6),et=[Ze],tt={props:{focus:String},setup(s){const a=s,t=k(),r=M(),o=m(!1),l=m(null),n=m(null);function i(){t.push({name:r.name,query:C(C({},l.value.value?{queue:l.value.value}:{}),n.value?{status:n.value}:{})})}function c(u){u===""&&i()}return A(()=>{setTimeout(()=>o.value=!0),a.focus==="queue"&&l.value.focus()}),(u,f)=>(d(),_("div",{class:g(["w-[300px] fixed transition-transform right-0 top-0 p-6 px-6 shadow-2xl h-screen bg-white",{"translate-x-[300px]":o.value===!1}])},[Je,e("input",{type:"text",name:"queue",id:"queue",ref_key:"queue",ref:l,class:"bg-white py-2 px-3 w-full rounded border",onKeyup:[B(i,["enter"]),f[0]||(f[0]=v=>c(v.target.value))]},null,40,Xe),Ye,O(e("select",{name:"status",id:"status","onUpdate:modelValue":f[1]||(f[1]=v=>n.value=v),class:"bg-white py-2 px-3 w-full rounded border"},et,512),[[oe,n.value]]),e("button",{class:"bg-indigo-500 w-full mt-4 text-indigo-100 rounded py-2",onClick:i}," Apply Filter (or Press Enter) ")],2))}};const st={class:"text-4xl mb-2"},ot={class:"text-lg"},at={class:"flex flex-row mt-6"},nt={class:"flex-1"},lt={class:"align-middle"},rt={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"},it={class:"table-fixed divide-y divide-gray-200 w-full"},ct={class:"bg-gray-50"},ut=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[50px]"}," # ",-1),dt=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider max-w-xl w-[300px]"}," Name ",-1),pt=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[100px]"}," Status ",-1),_t=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[150px] text-center"}," Attempts ",-1),ht=e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[200px]"}," Created ",-1),mt={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ft=y(" Queue "),xt={class:"inline relative"},vt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"},null,-1),gt=[vt],yt=e("th",{scope:"col",class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"Edit")],-1),bt={key:1},wt=e("tr",null,[e("td",{colspan:"7",class:"px-6 py-4 bg-white"},"No results.")],-1),kt=[wt],$t={class:"bg-white divide-y divide-gray-200"},Ct=["onClick"],qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Tt={class:"px-6 py-4 whitespace-nowrap text-ellipsis text-sm text-gray-900"},St={class:"px-6 py-4 whitespace-nowrap"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt=e("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[e("a",{href:"#",class:"text-indigo-600 hover:text-indigo-900"},"View")],-1),R={props:{title:String,description:String,tasks:Array},setup(s){const a=s,t=m([]),r=m([]),o=m({visible:!1,focus:null});function l(n){t.value.push(n.id),setTimeout(()=>{t.value.splice(t.value.indexOf(n.id),1)},1e3)}return ne(()=>a.tasks,(n,i)=>{var c;if(!!i){r.value=[],i.map((u,f)=>{r[u.id]=f});for(const u of n)(r[u.id]===void 0||((c=i[r[u.id]])==null?void 0:c.status)!==u.status)&&l(u)}}),(n,i)=>(d(),_(w,null,[e("h1",st,p(s.title),1),e("p",ot,p(s.description),1),e("div",at,[e("div",nt,[e("div",lt,[e("div",rt,[e("table",it,[e("thead",ct,[e("tr",null,[ut,dt,pt,_t,ht,e("th",mt,[ft,e("div",xt,[(d(),_("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline transition-transform hover:scale-[1.1] cursor-pointer",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",onClick:i[0]||(i[0]=()=>{o.value.visible=!o.value.visible,o.value.focus=o.value.visible?"queue":null})},gt))])]),yt])]),s.tasks===null?(d(),q(We,{key:0})):$("",!0),s.tasks&&s.tasks.length===0?(d(),_("tbody",bt,kt)):$("",!0),e("tbody",$t,[(d(!0),_(w,null,j(s.tasks,c=>(d(),_("tr",{class:g(["cursor-pointer hover:bg-indigo-100/10 transition-colors",{"bg-blue-300/30":t.value.includes(c.id)}]),onClick:u=>n.$router.push({name:`${n.$route.name}-task`,params:{uuid:c.uuid}})},[e("td",qt,p(c.id),1),e("td",Tt,p(c.name.substring(0,30))+p(c.name.length>30?"...":""),1),e("td",St,[h(H,{status:c.status},null,8,["status"])]),e("td",At,p(c.attempts),1),e("td",It,p(c.created),1),e("td",Lt,p(c.queue),1),Rt],10,Ct))),256))])])])])])]),o.value.visible?(d(),q(tt,{key:0,visible:o.value.visible,focus:o.value.focus},null,8,["visible","focus"])):$("",!0)],64))}},Pt={props:{tasks:Array},setup(s){const a=m(null),t=k();return L(a,{filter:"recent"},t),(r,o)=>(d(),q(R,{title:"Recent tasks",description:"Tasks that have been added or processed in the queue recently.",tasks:a.value},null,8,["tasks"]))}},Ut={props:{tasks:Array},setup(s){const a=m(null),t=k();return L(a,{status:"queued"},t),(r,o)=>(d(),q(R,{title:"Queued tasks",description:"Tasks that have been added to the queue recently.",tasks:a.value},null,8,["tasks"]))}},Dt={props:{tasks:Array},setup(s){const a=m(null),t=k();return L(a,{filter:"failed"},t),(r,o)=>(d(),q(R,{title:"Failed tasks",description:"Tasks that permanently failed after they have reached their max number of attempts.",tasks:a.value},null,8,["tasks"]))}};const Et={class:"absolute flex items-center justify-center w-2 h-2 bg-gray-200 rounded-full -left-1 ring-1 mt-3 ring-white"},Vt={props:{status:String,classes:{type:Array,default:[]}},setup(s){return(a,t)=>(d(),_("span",Et))}};var Ot=T(Vt,[["__scopeId","data-v-35155177"]]);const P=s=>(F("data-v-d792a216"),s=s(),N(),s),Bt={class:"text-4xl mb-2"},Ft={class:"flex"},Nt={class:"basis-[400px] shrink-0 pr-6 w-2/12"},Mt={class:"flex-initial sticky ml-4 mt-12"},jt={class:"relative border-l border-gray-200 dark:border-gray-700"},zt={class:"text-gray-900"},Ht={key:0,class:"bg-blue-100 text-blue-800 text-xs font-medium mr-2 inline-block mb-1 px-1.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800"},Kt={key:0},Qt={class:"bg-gray-200 text-gray-800 text-xs font-medium mr-2 inline-block mb-1 px-1.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800"},Gt={class:"block mb-2 mt-2 text-xs text-black/70 font-normal leading-none"},Wt={class:"cursor-default"},Jt={class:"basis-auto overflow-x-auto pr-12"},Xt=P(()=>e("h2",{class:"text-2xl"},"Task Exception",-1)),Yt={class:"text-xs p-8 border border-[#ccc/80] bg-white/90 mt-4 rounded overflow-auto no-scroll"},Zt={key:1,class:"mt-12"},es=P(()=>e("h2",{class:"text-2xl"},"Task Payload",-1)),ts={class:"text-xs p-8 border border-[#ccc/80] bg-white/90 mt-4 rounded overflow-auto no-scroll"},ss=P(()=>e("div",{class:"basis-[250px] shrink-0 px-6"},[e("h2",{class:"text-3xl"},"Actions"),e("button",{class:"bg-gray-200 text-black/20 cursor-not-allowed mt-4 w-full rounded px-4 py-2"}," Retry "),e("span",{class:"text-xs text-gray-800 mt-2 inline-block"},"Retrying tasks is not available yet.")],-1)),os={setup(s){const a=M(),t=k(),r=m({id:null,status:"loading"});A(()=>b(this,null,function*(){r.value=yield I({endpoint:`task/${a.params.uuid}`,router:t})}));const o={scheduled:"Scheduled",queued:"Added to the queue",running:"Running",successful:"Successful",error:"An error occurred",failed:"Failed permanently"};return(l,n)=>{const i=S("Popper");return d(),_(w,null,[e("h1",Bt,"Task #"+p(r.value.id),1),h(H,{status:r.value.status,classes:["text-sm"]},null,8,["status"]),e("div",Ft,[e("div",Nt,[e("div",Mt,[e("ol",jt,[(d(!0),_(w,null,j(r.value.events,(c,u)=>(d(),_("li",{class:g(["ml-10 pt-1 mb-6",[`event-${c.status}`]])},[h(Ot,{status:c.status},null,8,["status"]),e("h3",zt,[y(p(o[c.status]||c.status)+" ",1),e("div",null,[c.queue?(d(),_("span",Ht,p(r.value.queue),1)):$("",!0)]),c.scheduled_at?(d(),_("div",Kt,[e("span",Qt," Scheduled: "+p(c.scheduled_at)+" (UTC) ",1)])):$("",!0)]),h(i,{content:c.datetime,hover:!0,arrow:!0,placement:"right"},{default:x(()=>[e("time",Gt,[e("span",Wt,p(c.diff),1)])]),_:2},1032,["content"])],2))),256))])])]),e("div",Jt,[r.value.exception?(d(),_(w,{key:0},[Xt,e("pre",Yt,p(r.value.exception),1)],64)):$("",!0),r.value.payload?(d(),_("div",Zt,[es,e("pre",ts,p(r.value.payload),1)])):$("",!0)]),ss])],64)}}};var U=T(os,[["__scopeId","data-v-d792a216"]]);const as=[{name:"home",path:"/",component:ze},{name:"login",path:"/login",component:Te},{name:"recent",path:"/recent",component:Pt,meta:{route:"recent"}},{name:"recent-task",path:"/recent/:uuid",component:U,meta:{route:"recent"}},{name:"queued",path:"/queued",component:Ut,meta:{route:"queued"}},{name:"queued-task",path:"/queued/:uuid",component:U,meta:{route:"queued"}},{name:"failed",path:"/failed",component:Dt,meta:{route:"failed"}},{name:"failed-task",path:"/failed/:uuid",component:U,meta:{route:"failed"}}];let K=null;"CloudTasks"in window&&(K=`/${window.CloudTasks.path}`);const Q=le({history:re(K),routes:as});Q.beforeEach((s,a,t)=>!localStorage.hasOwnProperty("cloud-tasks-token")&&s.name!=="login"?t({name:"login"}):t());ie(be).use(Q).component("Popper",ce).mount("#app");
